# Cервис для управления номерами отелей и бронированиями.

Реализовано на Lumen PHP Framework.

## Запуск проекта

- Скачиваем проект из репозитория
  
  `git clone https://github.com/daawud/avito-test.git`

- Устанавливаем необходимые пакеты

    `composer install`

- Переходим в папку docker, копируем конфигурационный файл

  `cd docker/`

  `cp .env.example .env`

- Собираем проект

  `./dctl.sh build` 

- Запускаем проект

    `./up.sh`

- Создаем символическую ссылку на конфигурационный файл

    `ln -s .env ../.env`

- Заходим в контейнер

    `./dctl.sh run`

- Применяем миграции

  `php artisan migrate`

- Для остановки контейнеров в конце работы

    `./down.sh`


## Методы API

### Добавление номера отеля

- Запрос: `POST http://localhost/api/rooms`

- Параметры запроса:
  
  {
  
      "description": "Номер-люкс",
      "price": 4750
  }
  
- Ответ:
  
  {
  
      "room_id": 1
  }

### Получение списка номеров отеля

- Запрос: `GET http://localhost/api/rooms`

- Параметры запроса:

    сортировка по возрастанию цены `?sort=price`
  
    сортировка по убыванию цены `?sort=-price`
  
    сортировка по дате добавления (возрастанию) `?sort=added_on`
  
    сортировка по дате добавления (убыванию) `?sort=-added_on`

- Ответ:
  
  {
  
      "data": 
      [
          {
              "room_id": 1,
              "description": "Номер-люкс",
              "price": 4750,
              "added_on": "2021-01-05"
          },
          {
              "room_id": 4,
              "description": "Премиум",
              "price": 5300,
              "added_on": "2021-01-05"
          },
          {
              "room_id": 3,
              "description": "Президентский люкс",
              "price": 8100,
              "added_on": "2021-01-05"
          }
      ]
  }

### Удаление номера отеля и всех его броней

- Запрос: `DELETE http://localhost/api/rooms/{id}`

- Параметры запроса:

      {id}: идентификатор удаляемого номера

- Ответ:

  {

      "data": true
  }

### Добавление брони

- Запрос: `POST http://localhost/api/bookings`

- Параметры запроса:

  {

      "room_id": 3,
      "date_start": "2021-01-07",
      "date_end": "2021-01-07"
  }

    Забронировать номер можно только начиная со следующего дня относительно даты создания брони. Бронировать можно одним днем (т.е. date_start = date_end валидно)

- Ответ:

  {

      "booking_id": 1
  }

### Получение списка броней номеров отеля

- Запрос: `GET http://localhost/api/rooms/{id}/bookings`

- Параметры запроса:

      {id}: идентификатор номера, для которого получается список броней

- Ответ:

  {

      "data": 
      [
        {
            "booking_id": 1,
            "date_start": "2021-01-06",
            "date_end": "2021-01-07"
        },
        {
            "booking_id": 3,
            "date_start": "2021-01-07",
            "date_end": "2021-01-07"
        }
      ]
  }

### Удаление брони

- Запрос: `DELETE http://localhost/api/bookings/{id}`

- Параметры запроса:

      {id}: идентификатор удаляемой брони

- Ответ:

  {

      "data": true
  }
